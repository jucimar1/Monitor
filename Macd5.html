<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ“Š MACD Scanner Pro</title>
    <style>
        /* Design System */
        :root {
            --bg-dark: #0f172a;
            --card-bg: #1e293b;
            --accent: #38bdf8;
            --bull: #22c55e;
            --bear: #ef4444;
            --text-main: #f1f5f9;
            --text-dim: #94a3b8;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            padding: 20px;
            line-height: 1.5;
        }

        .container { max-width: 1200px; margin: 0 auto; }

        /* Header & Stats */
        .header {
            text-align: center;
            padding: 40px 0;
            border-bottom: 1px solid #334155;
            margin-bottom: 30px;
        }

        h1 { font-size: 2.5rem; color: var(--accent); margin-bottom: 10px; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-box {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #334155;
        }

        .stat-box span { display: block; color: var(--text-dim); font-size: 0.875rem; }
        .stat-box strong { font-size: 1.5rem; color: var(--text-main); }

        /* Grid de Alertas */
        .alerts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid transparent;
            transition: transform 0.2s;
            animation: fadeIn 0.5s ease-out;
        }

        .card:hover { transform: translateY(-3px); }
        .card.bull { border-left-color: var(--bull); }
        .card.bear { border-left-color: var(--bear); }

        .symbol-name { font-size: 1.25rem; font-weight: 700; margin-bottom: 8px; }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 15px;
        }

        .bull .badge { background: #14532d; color: #4ade80; }
        .bear .badge { background: #7f1d1d; color: #f87171; }

        .data-row { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 0.9rem; }
        .label { color: var(--text-dim); }

        .conf-high { color: var(--bull); font-weight: bold; }
        .conf-low { color: var(--text-dim); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Status de Carregamento */
        #status-msg { text-align: center; color: var(--text-dim); margin-top: 50px; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>MACD Scanner ðŸš€</h1>
        <p>Monitorando cruzamentos de linha zero (1 Hora)</p>
        
        <div class="stats-grid">
            <div class="stat-box"><span>Ativos Analisados</span><strong id="total-assets">0</strong></div>
            <div class="stat-box"><span>Sinais Ativos</span><strong id="active-signals">0</strong></div>
            <div class="stat-box"><span>Atualizado em</span><strong id="last-time">--:--</strong></div>
        </div>
    </div>

    <div id="alerts-container" class="alerts-grid">
        <!-- Cards de sinais aparecerÃ£o aqui -->
    </div>
    <div id="status-msg">Iniciando scanner de mercado...</div>
</div>

<script>
    // ConfiguraÃ§Ãµes Principais
    const MOEDAS = ['BTCUSDT', 'ETHUSDT', 'SOLUSDT', 'BNBUSDT', 'XRPUSDT', 'ADAUSDT', 'DOTUSDT', 'LINKUSDT', 'AVAXUSDT', 'MATICUSDT'];
    const TIMEFRAME = '1h';

    // FunÃ§Ã£o EMA (MÃ©dia MÃ³vel Exponencial)
    function EMA(data, period) {
        const k = 2 / (period + 1);
        let ema = [data[0]];
        for (let i = 1; i < data.length; i++) {
            ema.push(data[i] * k + ema[i - 1] * (1 - k));
        }
        return ema;
    }

    async function scanMarket() {
        const container = document.getElementById('alerts-container');
        const statusMsg = document.getElementById('status-msg');
        let countSinais = 0;
        let htmlContent = '';

        for (const symbol of MOEDAS) {
            try {
                // Busca 100 velas da API da Binance
                const response = await fetch(`https://binance.com{symbol}&interval=${TIMEFRAME}&limit=100`);
                const candles = await response.json();

                const closes = candles.map(c => parseFloat(c[4]));
                const volumes = candles.map(c => parseFloat(c[5]));

                // CÃ¡lculo MACD (12, 26, 9)
                const ema12 = EMA(closes, 12);
                const ema26 = EMA(closes, 26);
                const macdLine = ema12.map((val, i) => val - ema26[i]);
                const signalLine = EMA(macdLine, 9);
                const histogram = macdLine.map((val, i) => val - signalLine[i]);

                // Cruzamento de Linha Zero
                const currentH = histogram[histogram.length - 1];
                const prevH = histogram[histogram.length - 2];
                
                // ValidaÃ§Ã£o de Volume
                const currentVol = volumes[volumes.length - 1];
                const avgVol = volumes.slice(-21, -1).reduce((a, b) => a + b) / 20;
                const volRatio = (currentVol / avgVol).toFixed(2);

                let trend = null;
                if (prevH < 0 && currentH > 0) trend = 'bull';
                if (prevH > 0 && currentH < 0) trend = 'bear';

                if (trend) {
                    countSinais++;
                    htmlContent += `
                        <div class="card ${trend}">
                            <div class="symbol-name">${symbol}</div>
                            <div class="badge">${trend === 'bull' ? 'Cruzamento de Alta' : 'Cruzamento de Baixa'}</div>
                            <div class="data-row"><span class="label">Histograma:</span><strong>${currentH.toFixed(4)}</strong></div>
                            <div class="data-row"><span class="label">Vol vs MÃ©dia:</span><strong>${volRatio}x</strong></div>
                            <div class="data-row"><span class="label">ConfirmaÃ§Ã£o:</span>
                                <span class="${volRatio >= 1.5 ? 'conf-high' : 'conf-low'}">
                                    ${volRatio >= 1.5 ? 'Forte (Volume High)' : 'Moderada'}
                                </span>
                            </div>
                        </div>
                    `;
                }
            } catch (err) {
                console.error("Erro ao processar: " + symbol);
            }
        }

        // Atualiza Interface
        document.getElementById('total-assets').innerText = MOEDAS.length;
        document.getElementById('active-signals').innerText = countSinais;
        document.getElementById('last-time').innerText = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        
        container.innerHTML = htmlContent;
        statusMsg.style.display = htmlContent ? 'none' : 'block';
        statusMsg.innerText = "Nenhum sinal detectado no momento. PrÃ³ximo scan em 60s.";
    }

    // Iniciar Scanner
    scanMarket();
    setInterval(scanMarket, 60000); // Roda a cada 1 minuto
</script>

</body>
</html>
